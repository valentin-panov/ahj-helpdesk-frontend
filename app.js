!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=47)}([function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,n(23))},function(t,e,n){var r=n(27),i={}.hasOwnProperty;t.exports=function(t,e){return i.call(r(t),e)}},function(t,e,n){var r=n(4);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){var r=n(2),i=n(7),o=n(12);t.exports=r?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var r=n(25),i=n(13);t.exports=function(t){return r(i(t))}},function(t,e,n){var r=n(2),i=n(15),o=n(16),a=n(14),s=Object.defineProperty;e.f=r?s:function(t,e,n){if(o(t),e=a(e,!0),o(n),i)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var r=n(0),i=n(5);t.exports=function(t,e){try{i(r,t,e)}catch(n){r[t]=e}return e}},function(t,e,n){var r=n(0),i=n(8),o=r["__core-js_shared__"]||i("__core-js_shared__",{});t.exports=o},function(t,e,n){"use strict";var r=n(22),i=n(2),o=n(0),a=n(1),s=n(3),u=n(7).f,c=n(19),l=o.Symbol;if(i&&"function"==typeof l&&(!("description"in l.prototype)||void 0!==l().description)){var f={},d=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof d?new l(t):void 0===t?l():l(t);return""===t&&(f[e]=!0),e};c(d,l);var p=d.prototype=l.prototype;p.constructor=d;var v=p.toString,h="Symbol(test)"==String(l("test")),m=/^Symbol\((.*)\)[^)]+$/;u(p,"description",{configurable:!0,get:function(){var t=s(this)?this.valueOf():this,e=v.call(t);if(a(f,t))return"";var n=h?e.slice(7,-1):e.replace(m,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:d})}},function(t,e,n){var r=n(2),i=n(24),o=n(12),a=n(6),s=n(14),u=n(1),c=n(15),l=Object.getOwnPropertyDescriptor;e.f=r?l:function(t,e){if(t=a(t),e=s(e,!0),c)try{return l(t,e)}catch(t){}if(u(t,e))return o(!i.f.call(t,e),t[e])}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,n){var r=n(3);t.exports=function(t,e){if(!r(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;if("function"==typeof(n=t.valueOf)&&!r(i=n.call(t)))return i;if(!e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var r=n(2),i=n(4),o=n(28);t.exports=!r&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){var r=n(3);t.exports=function(t){if(!r(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,n){var r=n(9),i=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(t){return i.call(t)}),t.exports=r.inspectSource},function(t,e){t.exports={}},function(t,e,n){var r=n(1),i=n(36),o=n(11),a=n(7);t.exports=function(t,e){for(var n=i(e),s=a.f,u=o.f,c=0;c<n.length;c++){var l=n[c];r(t,l)||s(t,l,u(e,l))}}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e,n){},function(t,e,n){var r=n(0),i=n(11).f,o=n(5),a=n(29),s=n(8),u=n(19),c=n(46);t.exports=function(t,e){var n,l,f,d,p,v=t.target,h=t.global,m=t.stat;if(n=h?r:m?r[v]||s(v,{}):(r[v]||{}).prototype)for(l in e){if(d=e[l],f=t.noTargetGet?(p=i(n,l))&&p.value:n[l],!c(h?l:v+(m?".":"#")+l,t.forced)&&void 0!==f){if(typeof d==typeof f)continue;u(d,f)}(t.sham||f&&f.sham)&&o(d,"sham",!0),a(n,l,d,t)}}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!r.call({1:2},1);e.f=o?function(t){var e=i(this,t);return!!e&&e.enumerable}:r},function(t,e,n){var r=n(4),i=n(26),o="".split;t.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==i(t)?o.call(t,""):Object(t)}:Object},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var r=n(13);t.exports=function(t){return Object(r(t))}},function(t,e,n){var r=n(0),i=n(3),o=r.document,a=i(o)&&i(o.createElement);t.exports=function(t){return a?o.createElement(t):{}}},function(t,e,n){var r=n(0),i=n(5),o=n(1),a=n(8),s=n(17),u=n(30),c=u.get,l=u.enforce,f=String(String).split("String");(t.exports=function(t,e,n,s){var u,c=!!s&&!!s.unsafe,d=!!s&&!!s.enumerable,p=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof e||o(n,"name")||i(n,"name",e),(u=l(n)).source||(u.source=f.join("string"==typeof e?e:""))),t!==r?(c?!p&&t[e]&&(d=!0):delete t[e],d?t[e]=n:i(t,e,n)):d?t[e]=n:a(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||s(this)}))},function(t,e,n){var r,i,o,a=n(31),s=n(0),u=n(3),c=n(5),l=n(1),f=n(9),d=n(32),p=n(18),v=s.WeakMap;if(a||f.state){var h=f.state||(f.state=new v),m=h.get,y=h.has,b=h.set;r=function(t,e){if(y.call(h,t))throw new TypeError("Object already initialized");return e.facade=t,b.call(h,t,e),e},i=function(t){return m.call(h,t)||{}},o=function(t){return y.call(h,t)}}else{var g=d("state");p[g]=!0,r=function(t,e){if(l(t,g))throw new TypeError("Object already initialized");return e.facade=t,c(t,g,e),e},i=function(t){return l(t,g)?t[g]:{}},o=function(t){return l(t,g)}}t.exports={set:r,get:i,has:o,enforce:function(t){return o(t)?i(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!u(e)||(n=i(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}}},function(t,e,n){var r=n(0),i=n(17),o=r.WeakMap;t.exports="function"==typeof o&&/native code/.test(i(o))},function(t,e,n){var r=n(33),i=n(35),o=r("keys");t.exports=function(t){return o[t]||(o[t]=i(t))}},function(t,e,n){var r=n(34),i=n(9);(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.1",mode:r?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(t,e){t.exports=!1},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++n+r).toString(36)}},function(t,e,n){var r=n(37),i=n(39),o=n(45),a=n(16);t.exports=r("Reflect","ownKeys")||function(t){var e=i.f(a(t)),n=o.f;return n?e.concat(n(t)):e}},function(t,e,n){var r=n(38),i=n(0),o=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?o(r[t])||o(i[t]):r[t]&&r[t][e]||i[t]&&i[t][e]}},function(t,e,n){var r=n(0);t.exports=r},function(t,e,n){var r=n(40),i=n(44).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,i)}},function(t,e,n){var r=n(1),i=n(6),o=n(41).indexOf,a=n(18);t.exports=function(t,e){var n,s=i(t),u=0,c=[];for(n in s)!r(a,n)&&r(s,n)&&c.push(n);for(;e.length>u;)r(s,n=e[u++])&&(~o(c,n)||c.push(n));return c}},function(t,e,n){var r=n(6),i=n(42),o=n(43),a=function(t){return function(e,n,a){var s,u=r(e),c=i(u.length),l=o(a,c);if(t&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((t||l in u)&&u[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},function(t,e,n){var r=n(20),i=Math.min;t.exports=function(t){return t>0?i(r(t),9007199254740991):0}},function(t,e,n){var r=n(20),i=Math.max,o=Math.min;t.exports=function(t,e){var n=r(t);return n<0?i(n+e,0):o(n,e)}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var r=n(4),i=/#|\.prototype\./,o=function(t,e){var n=s[a(t)];return n==c||n!=u&&("function"==typeof e?r(e):!!e)},a=o.normalize=function(t){return String(t).replace(i,".").toLowerCase()},s=o.data={},u=o.NATIVE="N",c=o.POLYFILL="P";t.exports=o},function(t,e,n){"use strict";n.r(e);n(21),n(10);var r={name:{valueMissing:"Пожалуйста, заполните это поле"},description:{valueMissing:"Пожалуйста, заполните это поле"}};async function i(t){const e="https://vp-ahj-helpdesk.herokuapp.com/?"+t.query,n=await fetch(e,{method:t.method,headers:new Headers({"content-type":"application/json"}),body:t.data?JSON.stringify(t.data):null});return await n.json()}class o{listing(){return i({method:"GET",query:"method=allTickets"})}create(t){return i({method:"POST",query:"method=createTicket",data:t})}delete(t){return i({method:"GET",query:"method=deleteById&id="+t})}update(t,e){return i({method:"POST",query:"method=updateById&id="+t,data:e})}get(t){return i({method:"GET",query:"method=ticketById&id="+t})}}class a{constructor(){this.api=new o,this.units=[]}init(){this.renderContainer(),this.renderUnits()}renderContainer(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("wrapper"),this.wrapper.append(function(){const t=document.createElement("div");return t.classList.add("unit-container"),t.innerHTML='\n    <div class="container__header">\n      <span class="btn btn-add">Добавить тикет</span>\n    </div>\n    <h2 class="unit-false">ВСЁ СДелано. АкТивныХ Тикетов НеТ.</h2>\n      <ul class="unit-list">\n      </ul>\n  ',t}()),document.body.append(this.wrapper),this.wrapper.querySelector(".btn-add").addEventListener("click",t=>{t.preventDefault(),this.unitFormShow(t.target)},!1),this.wrapper.addEventListener("click",t=>{if(t.preventDefault(),t.target===this.wrapper)try{this.allFormsClose()}catch(t){}},!1)}async renderUnits(){this.allFormsClose(),this.units=await this.api.listing();const t=this.wrapper.querySelector(".unit-list");t.innerHTML="";const e=this.wrapper.querySelector(".unit-false");e.classList.remove("visually-hidden"),this.units.forEach(n=>{const r=function(t){const e=document.createElement("li");e.classList.add("unit"),e.dataset.unitId=t.id,e.dataset.status=t.status;const n=t.status?"":"visually-hidden";return e.innerHTML=`\n    <div class="unit-wrapper">\n      <div class="unit-item unit-icon-wrapper unit-status">\n        <span class="unit-status-icon ${n}">&#10003</span>\n      </div>\n      <div class="unit-item unit-text">${t.name}\n        <div class="unit-item unit-description"></div>\n      </div>\n      <div class="unit-item unit-date">${t.created}</div>\n      <div class="unit-item unit-icon-wrapper unit-edit">&#9998</div>\n      <div class="unit-item unit-icon-wrapper unit-delete">&#10005</div>\n    </div>\n    \n  `,e}(n);t.append(r),this.addUnitListeners(r),e.classList.add("visually-hidden")})}addUnitListeners(t){t.querySelector(".unit-status").addEventListener("click",t=>{t.preventDefault(),this.unitStatusChange(t.target)},!1),t.querySelector(".unit-text").addEventListener("click",t=>{t.preventDefault(),this.unitDescrToggle(t.target)},!1),t.querySelector(".unit-edit").addEventListener("click",t=>{t.preventDefault(),this.unitFormShow(t.target.closest("li.unit"))},!1),t.querySelector(".unit-delete").addEventListener("click",t=>{t.preventDefault(),this.unitDelete(t.target.closest("li.unit"))},!1)}async unitStatusChange(t){const e=t.closest("li.unit").dataset.unitId;let{status:n}=t.closest("li.unit").dataset;n=!("true"===n);const r={status:n};await this.api.update(e,r),await this.renderUnits()}async unitDescrToggle(t){const e=t.closest("li.unit").dataset.unitId,n=await this.api.get(e),r=t.closest("li.unit").querySelector(".unit-description");r.style.maxWidth=t.closest("li.unit").querySelector(".unit-text").offsetWidth+"px",r.innerHTML=n.description}unitFormShow(t){try{this.allFormsClose()}catch(t){}const e=function(t){const e=t.id?"Изменить тикет":"Добавить тикет",n=document.createElement("div");return n.classList.add("unitForm"),n.innerHTML=`\n    <form name="unitForm" data-id="${t.id}" novalidate class="form">\n      \n      <h2 class="unitForm__header">${e}</h2>\n\n      <input class="form__input" type="text" name="name" value="${t.name}" required placeholder="Введите имя тикета"></textarea>\n      \n      <textarea class="form__input" type="text" name="description" required placeholder="Введите описание тикета">${t.description.replace(/<br\s*\/?>/gm,"\n")}</textarea>\n      \n      <div class="form__input-button-holder">\n        <button type="button" class="btn btn-cancel">Отмена</button>\n        <button type="submit" class="btn btn-submit">Ok</button>\n      </div>\n    </form>\n  `,n}(t.dataset.unitId?this.units.find(e=>e.id===t.dataset.unitId):{id:"",name:"",description:""}),n=document.querySelector(".unit-container");n.append(e),this.modalPlace(n,e),e.querySelector(".btn-cancel").addEventListener("click",t=>{t.preventDefault(),this.allFormsClose()},!1),e.querySelector(".btn-submit").addEventListener("click",t=>{t.preventDefault(),this.unitPush(t.target)},!1),e.querySelector("input.form__input").focus()}async unitPush(t){const e=document.forms.unitForm;if(!this.checkFormValidity(e))return;const n=new FormData(e),{id:r}=t.closest(".form").dataset,i={};n.forEach((t,e)=>{i[e]=t}),i.description=i.description.replace(/(?:\r\n|\r|\n)/g,"<br>"),r?r&&await this.api.update(r,i):await this.api.create(i),this.allFormsClose(),await this.renderUnits()}unitDelete(t){try{this.allFormsClose()}catch(t){}const e=function(t){const e=document.createElement("div");return e.classList.add("unitForm"),e.innerHTML=`\n    <form name="unitDeleteForm" data-id="${t}" novalidate class="form">\n      \n      <h2 class="unitForm__header">Удалить тикет</h2>\n\n      <span class="unit-delete-text">Вы уверены, что хотите удалить тикет? Это действие необратимо.</span>\n      \n      <div class="form__input-button-holder">\n        <button type="button" class="btn btn-cancel">Отмена</button>\n        <button type="submit" class="btn btn-submit">Ok</button>\n      </div>\n    </form>\n  `,e}(t.dataset.unitId),n=document.querySelector(".unit-container");n.append(e),this.modalPlace(n,e),e.querySelector(".btn-cancel").addEventListener("click",t=>{t.preventDefault(),this.allFormsClose()},!1),e.querySelector(".btn-submit").addEventListener("click",async e=>{e.preventDefault(),await this.api.delete(t.dataset.unitId),this.renderUnits()},!1)}checkFormValidity(t){let{error:e}=this;e&&(e.remove(),e=null);if(!t.checkValidity()){[...t.elements].filter(t=>t.validity.valid&&!t.classList.contains("btn")).forEach(t=>{t.classList.add("valid"),t.classList.remove("invalid")});const n=[...t.elements].find(t=>!t.validity.valid);n.focus(),n.classList.remove("valid"),n.classList.add("invalid");const i=n.validity;let o="Неизвестная ошибка";for(const t in i)i[t]&&(o=t);return e=document.createElement("div"),e.dataset.id="error",e.className="form-error",e.textContent=""+r[n.name][o],n.offsetParent.appendChild(e),e.style.top=n.offsetTop+"px",e.style.left=n.offsetLeft+n.offsetWidth+"px",this.error=e,!1}return!0}modalPlace(t,e){e.style.width=.8*t.offsetWidth+"px",e.style.top=t.offsetTop+.9*e.offsetTop+"px",e.style.left=t.offsetLeft+t.offsetWidth/2-e.offsetWidth/2+"px"}allFormsClose(){[...document.querySelectorAll("div.unitForm")].forEach(t=>t.remove()),[...document.querySelectorAll("div.form-error")].forEach(t=>t.remove())}}(new a).init()}]);
//# sourceMappingURL=app.js.map